(function(e){e.fn.ribbon=function(l){return this.each(function(){var m=new d(this,l);m.render()})};function d(m,l){this.element=e(m);this.width=this.element.outerWidth();this.height=this.element.outerHeight();this.options=e.extend({darken_by:20,ends:"both",triangle_width:15,direction:"up",shadow:"0 5px 5px rgba(0,0,0,0.5)"},l);this.dark_color=this.darken(this.element.css("backgroundColor"),this.options.darken_by)}d.prototype={render:function a(){var l=this.buildContainer(),m=e(this.element).width()+this.options.triangle_width*(this.options.ends==="both"?2:1);this.element.css("width",m);if(this.options.shadow){this.addShadow()}this.element.replaceWith(l.append(this.addEnds(l,this.options.ends)).append(this.element.clone()))},buildContainer:function f(){var l=e('<div class="rectangle"></div>');l.css({position:this.element.css("position"),zIndex:"50",display:"inline-block",bottom:this.element.css("bottom"),top:this.element.css("top"),left:this.element.css("left"),right:this.element.css("right")});this.element.css("position","relative");return l},calculateOffset:function k(m){var l=function(n,o){var q=parseInt(e(n).css(o)),p=isNaN(q)?0:q;return p};return -1*this.options.triangle_width+l(m,"left")+l(m,"right")},addEnds:function h(n,m){var l="",o=!isNaN(parseInt(e(n).css("right")))?"right":"left";switch(m){case this.ends.left:e(n).css(o,this.calculateOffset(n));this.element.css({left:0,bottom:"auto",right:"auto"});return e("<div></div>").addClass("triangle triangle-l").css(e.extend({borderColor:"transparent "+this.dark_color+" transparent transparent",left:-1*this.options.triangle_width},this.endCss(),this.endDirectionCss()));case this.ends.right:return l=e("<div></div>").addClass("triangle triangle-r").css(e.extend({borderColor:"transparent transparent transparent "+this.dark_color,right:-1*this.options.triangle_width},this.endCss(),this.endDirectionCss()));case this.ends.both:return this.addEnds(n,this.ends.left).after(this.addEnds(n,this.ends.right))}return l},addShadow:function b(){this.element.css({"-moz-box-shadow":this.options.shadow,"-webkit-box-shadow":this.options.shadow,"box-shadow":this.options.shadow})},endCss:function j(){return{borderStyle:"solid",borderWidth:this.options.triangle_width,height:"0px",width:"0px",position:"absolute",zIndex:"-1"}},endDirectionCss:function c(){switch(this.options.direction){case"down":return{top:-1*this.options.triangle_width};case"up":return{bottom:-1*this.options.triangle_width}}},darken:function i(n,m){var t=n,s=Math.round(255*(m/100)),q=new Array(),p,o,l;if(n.charAt(0)=="#"){t=this.hex2rgb(n.substring(1))}if(q=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/)){p=(q[1]-s>0)?q[1]-s:0;o=(q[2]-s>0)?q[2]-s:0;l=(q[3]-s>0)?q[3]-s:0}else{p=o=l=256}return"rgb("+p+","+o+","+l+")"},hex2rgb:function g(l){var l=(l.substr(0,1)=="#")?l.substr(1):l;return"rgb("+parseInt(l.substr(0,2),16)+","+parseInt(l.substr(2,2),16)+","+parseInt(l.substr(4,2),16)+")"},ends:{both:"both",left:"left",right:"right"}}})(jQuery);